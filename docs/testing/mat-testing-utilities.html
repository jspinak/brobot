<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-testing/mat-testing-utilities" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Mat Testing Utilities | Brobot</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jspinak.github.io/brobot/docs/testing/mat-testing-utilities"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Mat Testing Utilities | Brobot"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/brobot/img/brobot-happy.ico"><link data-rh="true" rel="canonical" href="https://jspinak.github.io/brobot/docs/testing/mat-testing-utilities"><link data-rh="true" rel="alternate" href="https://jspinak.github.io/brobot/docs/testing/mat-testing-utilities" hreflang="en"><link data-rh="true" rel="alternate" href="https://jspinak.github.io/brobot/docs/testing/mat-testing-utilities" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Mat Testing Utilities","item":"https://jspinak.github.io/brobot/docs/testing/mat-testing-utilities"}]}</script><link rel="alternate" type="application/rss+xml" href="/brobot/blog/rss.xml" title="Brobot RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/brobot/blog/atom.xml" title="Brobot Atom Feed">




<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6WY1S6ZWEY"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6WY1S6ZWEY",{anonymize_ip:!0})</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous"><link rel="stylesheet" href="/brobot/assets/css/styles.1b22d91f.css">
<script src="/brobot/assets/js/runtime~main.21f391c9.js" defer="defer"></script>
<script src="/brobot/assets/js/main.74751b1e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/brobot/"><div class="navbar__logo"><img src="/brobot/img/brobot_logo/brobot-happy-text.svg" alt="Brobot Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/brobot/img/brobot_logo/brobot-happy-text.svg" alt="Brobot Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Brobot</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/brobot/docs/getting-started/introduction">Documentation</a><a href="https://jspinak.github.io/brobot/api/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a class="navbar__item navbar__link" href="/brobot/visualAPI">The Visual API</a><a class="navbar__item navbar__link" href="/brobot/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/brobot/docs/testing/mat-testing-utilities">Latest</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/brobot/docs/testing/mat-testing-utilities">Latest</a></li><li><a class="dropdown__link" href="/brobot/docs/1.0.7/getting-started/introduction">1.0.7</a></li><li><a class="dropdown__link" href="/brobot/docs/1.0.6/introduction">1.0.6</a></li></ul></div><a href="https://github.com/jspinak/brobot" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/brobot/docs/getting-started/introduction">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/brobot/docs/no-code-automation/desktop-runner/runner-overview">No-Code Automation (Beta)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/brobot/docs/core-library/guides/finding-objects/configuration-note">Core Library (for Developers)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/brobot/docs/testing/testing-intro">Testing Your Automation</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/testing-intro">Testing Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/integration-testing">Integration Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/mock-mode-guide">Mock Mode Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/actionhistory-mock-snapshots">ActionHistory and Mock Snapshots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/mock-mode-manager">Mock Mode Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/profile-based-architecture">Profile-Based Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/unit-testing">Unit Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/action-recording">Action Recording</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/actionhistory-integration-testing">ActionHistory Integration Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/mixed-mode-execution">Mixed-Mode Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/debugging-pattern-matching">Debugging Pattern Matching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/hybrid-architecture-summary">Hybrid Architecture Summary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/profile-based-testing">Profile-Based Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/test-utilities">Test Utilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/mock-mode-migration">Mock Mode Migration Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brobot/docs/testing/TESTING_STRATEGY">Brobot Testing Strategy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/brobot/docs/testing/mat-testing-utilities">Mat Testing Utilities</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/brobot/docs/category/theoretical-foundations">Theoretical Foundations</a><button aria-label="Expand sidebar category &#x27;Theoretical Foundations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/brobot/docs/category/integrations">Integrations</a><button aria-label="Expand sidebar category &#x27;Integrations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/brobot-name-origin">Origin of the Name Brobot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/ASPECTJ_USAGE_GUIDE">AspectJ Usage Guide for Brobot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/ai-brobot-project-creation">Brobot Documentation Guide for AI/LLMs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/capture-methods-comparison">Screenshot Capture Methods Comparison Study</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/complete-javacv-replacement">Complete SikuliX Replacement with JavaCV + Robot</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/brobot/docs/migration/actionoptions-to-actionconfig">migration</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/pattern-capture-tool-guide">Brobot Pattern Capture Tool Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/pattern-creation-tools">Pattern Creation Tools Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/preparing-folder-for-ai-project-creation">Preparing a Folder for AI-Assisted Brobot Project Creation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/quick-start-capture-setup">Quick Start: Pattern Capture Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brobot/docs/sikulix-to-javacv-migration">SikuliX to JavaCV Migration Strategy</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/brobot/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Testing Your Automation</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Mat Testing Utilities</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Latest</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Mat Testing Utilities</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>The <code>MatTestUtils</code> class provides comprehensive utilities for creating, managing, and testing OpenCV Mat objects in Brobot tests. These utilities help prevent JVM crashes caused by invalid Mat operations and ensure consistent test data creation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-features">Key Features<a href="#key-features" class="hash-link" aria-label="Direct link to Key Features" title="Direct link to Key Features">​</a></h2>
<ul>
<li><strong>Safe Mat Creation</strong>: Guaranteed valid Mat objects with proper initialization</li>
<li><strong>Pattern Generation</strong>: Pre-built patterns for testing image processing</li>
<li><strong>Validation</strong>: Built-in validation to catch issues before crashes occur</li>
<li><strong>Memory Management</strong>: Safe cleanup utilities to prevent memory leaks</li>
<li><strong>Test Data Helpers</strong>: Convenient methods for common test scenarios</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-use-mattestutils">Why Use MatTestUtils?<a href="#why-use-mattestutils" class="hash-link" aria-label="Direct link to Why Use MatTestUtils?" title="Direct link to Why Use MatTestUtils?">​</a></h2>
<p>OpenCV Mat operations can cause JVM crashes (SIGSEGV) when:</p>
<ul>
<li>Mats are uninitialized or empty</li>
<li>Mats are already released</li>
<li>Dimensions are invalid</li>
<li>Native memory is corrupted</li>
</ul>
<p>MatTestUtils prevents these issues by:</p>
<ol>
<li>Always creating properly initialized Mats</li>
<li>Validating Mats before operations</li>
<li>Providing safe cleanup methods</li>
<li>Offering defensive programming patterns</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-usage">Basic Usage<a href="#basic-usage" class="hash-link" aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="import-the-utilities">Import the Utilities<a href="#import-the-utilities" class="hash-link" aria-label="Direct link to Import the Utilities" title="Direct link to Import the Utilities">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import io.github.jspinak.brobot.test.utils.MatTestUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import static org.bytedeco.opencv.global.opencv_core.*;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-safe-mats">Creating Safe Mats<a href="#creating-safe-mats" class="hash-link" aria-label="Direct link to Creating Safe Mats" title="Direct link to Creating Safe Mats">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create a properly initialized Mat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat mat = MatTestUtils.createSafeMat(100, 100, CV_8UC3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create a filled Mat with specific color</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat redMat = MatTestUtils.createColorMat(100, 100, 0, 0, 255); // BGR format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create a grayscale Mat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat grayMat = MatTestUtils.createGrayMat(100, 100, 128); // Gray value 0-255</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a href="#validation" class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation">​</a></h3>
<p>Always validate Mats before risky operations:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Mat mat = someOperation();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.validateMat(mat, &quot;operation result&quot;);  // Throws if invalid</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="safe-cleanup">Safe Cleanup<a href="#safe-cleanup" class="hash-link" aria-label="Direct link to Safe Cleanup" title="Direct link to Safe Cleanup">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Single Mat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.safeRelease(mat);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Multiple Mats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.safeReleaseAll(mat1, mat2, mat3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// MatVector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.safeRelease(matVector);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-generation">Pattern Generation<a href="#pattern-generation" class="hash-link" aria-label="Direct link to Pattern Generation" title="Direct link to Pattern Generation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="checkerboard-pattern">Checkerboard Pattern<a href="#checkerboard-pattern" class="hash-link" aria-label="Direct link to Checkerboard Pattern" title="Direct link to Checkerboard Pattern">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Mat checkerboard = MatTestUtils.createCheckerboardMat(200, 200, 25);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Creates 200x200 image with 25-pixel squares</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gradient-pattern">Gradient Pattern<a href="#gradient-pattern" class="hash-link" aria-label="Direct link to Gradient Pattern" title="Direct link to Gradient Pattern">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Horizontal gradient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat horizontalGradient = MatTestUtils.createGradientMat(100, 100, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Vertical gradient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat verticalGradient = MatTestUtils.createGradientMat(100, 100, false);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="geometric-shapes">Geometric Shapes<a href="#geometric-shapes" class="hash-link" aria-label="Direct link to Geometric Shapes" title="Direct link to Geometric Shapes">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Rectangle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat rectangle = MatTestUtils.createShapeMat(100, 100, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Circle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat circle = MatTestUtils.createShapeMat(100, 100, 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat line = MatTestUtils.createShapeMat(100, 100, 2);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="noise-patterns">Noise Patterns<a href="#noise-patterns" class="hash-link" aria-label="Direct link to Noise Patterns" title="Direct link to Noise Patterns">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Random noise for testing filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat noisyImage = MatTestUtils.createNoiseMat(100, 100, CV_8UC3);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motion-detection-testing">Motion Detection Testing<a href="#motion-detection-testing" class="hash-link" aria-label="Direct link to Motion Detection Testing" title="Direct link to Motion Detection Testing">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-motion-sequences">Creating Motion Sequences<a href="#creating-motion-sequences" class="hash-link" aria-label="Direct link to Creating Motion Sequences" title="Direct link to Creating Motion Sequences">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Gradually changing images (for motion detection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatVector motionSequence = MatTestUtils.createMotionMatVector(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5,      // frame count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    100,    // height</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    100,    // width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    50      // change amount per frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-changed-regions">Creating Changed Regions<a href="#creating-changed-regions" class="hash-link" aria-label="Direct link to Creating Changed Regions" title="Direct link to Creating Changed Regions">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create sequence with specific changed region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatVector withChange = MatTestUtils.createMatVectorWithChange(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    100, 100,   // dimensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1,          // which frame has change</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    40, 40,     // change position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    20          // change size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mat-comparison">Mat Comparison<a href="#mat-comparison" class="hash-link" aria-label="Direct link to Mat Comparison" title="Direct link to Mat Comparison">​</a></h2>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Compare two Mats with tolerance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boolean similar = MatTestUtils.areMatsEqual(mat1, mat2, 5.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns true if average pixel difference is &lt;= 5.0</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging">Debugging<a href="#debugging" class="hash-link" aria-label="Direct link to Debugging" title="Direct link to Debugging">​</a></h2>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Get human-readable Mat description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String description = MatTestUtils.describeMat(mat, &quot;test_mat&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Output: &quot;test_mat: 100x100, type=16, channels=3&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-always-use-try-finally-for-cleanup">1. Always Use Try-Finally for Cleanup<a href="#1-always-use-try-finally-for-cleanup" class="hash-link" aria-label="Direct link to 1. Always Use Try-Finally for Cleanup" title="Direct link to 1. Always Use Try-Finally for Cleanup">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Mat mat1 = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat mat2 = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mat1 = MatTestUtils.createColorMat(100, 100, 255, 0, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mat2 = MatTestUtils.createColorMat(100, 100, 0, 255, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Test operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MatTestUtils.validateMat(mat1, &quot;mat1 before operation&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    performOperation(mat1, mat2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MatTestUtils.safeReleaseAll(mat1, mat2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-validate-before-operations">2. Validate Before Operations<a href="#2-validate-before-operations" class="hash-link" aria-label="Direct link to 2. Validate Before Operations" title="Direct link to 2. Validate Before Operations">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void testImageProcessing() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mat input = MatTestUtils.createGrayMat(100, 100, 128);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MatTestUtils.validateMat(input, &quot;input&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mat output = processImage(input);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MatTestUtils.validateMat(output, &quot;output&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assertTrue(MatTestUtils.areMatsEqual(input, output, 10.0));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-use-descriptive-context-in-validation">3. Use Descriptive Context in Validation<a href="#3-use-descriptive-context-in-validation" class="hash-link" aria-label="Direct link to 3. Use Descriptive Context in Validation" title="Direct link to 3. Use Descriptive Context in Validation">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.validateMat(mat, &quot;after dilation&quot;);  // Good</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.validateMat(mat, &quot;mat&quot;);            // Less helpful</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-create-matvectors-safely">4. Create MatVectors Safely<a href="#4-create-matvectors-safely" class="hash-link" aria-label="Direct link to 4. Create MatVectors Safely" title="Direct link to 4. Create MatVectors Safely">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Validate all Mats before creating MatVector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat mat1 = MatTestUtils.createColorMat(100, 100, 100, 100, 100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat mat2 = MatTestUtils.createColorMat(100, 100, 150, 150, 150);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mat mat3 = MatTestUtils.createColorMat(100, 100, 200, 200, 200);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.validateMat(mat1, &quot;mat1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.validateMat(mat2, &quot;mat2&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatTestUtils.validateMat(mat3, &quot;mat3&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatVector vector = new MatVector(mat1, mat2, mat3);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-test">Example Test<a href="#example-test" class="hash-link" aria-label="Direct link to Example Test" title="Direct link to Example Test">​</a></h2>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class MyImageProcessorTest extends BrobotTestBase {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void testEdgeDetection() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Create test image with shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Mat input = MatTestUtils.createShapeMat(200, 200, 1); // Circle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Validate input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MatTestUtils.validateMat(input, &quot;circle input&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Mat edges = detectEdges(input);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Validate output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MatTestUtils.validateMat(edges, &quot;edge detection result&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assertFalse(edges.empty());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Check that edges were found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            double edgeSum = sumElems(edges).get(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assertTrue(edgeSum &gt; 0, &quot;Should detect circle edges&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MatTestUtils.safeRelease(input);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void testMotionDetection() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Create motion sequence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MatVector frames = MatTestUtils.createMotionMatVector(3, 100, 100, 50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Build detector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MotionDetector detector = new MotionDetector.Builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setFrames(frames)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Check motion detected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Mat motionMask = detector.getMotionMask();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MatTestUtils.validateMat(motionMask, &quot;motion mask&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            double motion = sumElems(motionMask).get(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assertTrue(motion &gt; 0, &quot;Should detect motion between frames&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MatTestUtils.safeRelease(frames);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jvm-crashes-exit-code-134">JVM Crashes (Exit Code 134)<a href="#jvm-crashes-exit-code-134" class="hash-link" aria-label="Direct link to JVM Crashes (Exit Code 134)" title="Direct link to JVM Crashes (Exit Code 134)">​</a></h3>
<p>If you still experience crashes:</p>
<ol>
<li><strong>Check Mat dimensions</strong>: Ensure rows and cols are positive</li>
<li><strong>Verify Mat types match</strong>: Operations may require specific types</li>
<li><strong>Check native memory</strong>: Use smaller Mats in tests</li>
<li><strong>Enable logging</strong>: Add debug output before operations</li>
</ol>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Debug helper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(MatTestUtils.describeMat(mat, &quot;before_operation&quot;));</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-issues-and-solutions">Common Issues and Solutions<a href="#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions">​</a></h3>
<table><thead><tr><th>Issue</th><th>Solution</th></tr></thead><tbody><tr><td><code>Mat.isNull()</code> returns true</td><td>Use <code>createSafeMat()</code> instead of <code>new Mat()</code></td></tr><tr><td><code>Mat.empty()</code> returns true</td><td>Ensure dimensions &gt; 0 when creating</td></tr><tr><td>SIGSEGV on release</td><td>Use <code>safeRelease()</code> which checks null/released state</td></tr><tr><td>Operations fail silently</td><td>Add <code>validateMat()</code> calls before operations</td></tr><tr><td>Memory leaks</td><td>Always use try-finally with <code>safeReleaseAll()</code></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-pixelchangedetector">Integration with PixelChangeDetector<a href="#integration-with-pixelchangedetector" class="hash-link" aria-label="Direct link to Integration with PixelChangeDetector" title="Direct link to Integration with PixelChangeDetector">​</a></h2>
<p>When testing classes like <code>PixelChangeDetector</code> that perform complex Mat operations:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void testPixelChangeDetection() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create safe test images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mat img1 = MatTestUtils.createColorMat(100, 100, 100, 100, 100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mat img2 = MatTestUtils.createColorMat(100, 100, 100, 100, 100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add change region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rectangle(img2, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Point(40, 40), new Point(60, 60),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Scalar(200, 200, 200, 0), -1, 8, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Validate before use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MatTestUtils.validateMat(img1, &quot;img1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MatTestUtils.validateMat(img2, &quot;img2 with change&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MatVector frames = new MatVector(img1, img2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PixelChangeDetector detector = new PixelChangeDetector.Builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setMats(frames)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .useDilation(3, 3, CV_8U)  // Use safe kernel type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Mat changeMask = detector.getChangeMask();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MatTestUtils.validateMat(changeMask, &quot;change mask&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Verify changes detected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assertTrue(countNonZero(changeMask) &gt; 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MatTestUtils.safeReleaseAll(img1, img2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="see-also">See Also<a href="#see-also" class="hash-link" aria-label="Direct link to See Also" title="Direct link to See Also">​</a></h2>
<ul>
<li><a href="/brobot/docs/testing/mock-mode-guide">Mock Mode Testing</a></li>
<li><a href="/brobot/docs/testing/test-utilities">Test Utilities</a></li>
<li><a href="/brobot/docs/testing/unit-testing">Unit Testing</a></li>
<li><a href="/brobot/docs/testing/integration-testing">Integration Testing</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jspinak/brobot/edit/main/docs/docs/04-testing/mat-testing-utilities.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/brobot/docs/testing/TESTING_STRATEGY"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Brobot Testing Strategy</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/brobot/docs/category/theoretical-foundations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Theoretical Foundations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#key-features" class="table-of-contents__link toc-highlight">Key Features</a></li><li><a href="#why-use-mattestutils" class="table-of-contents__link toc-highlight">Why Use MatTestUtils?</a></li><li><a href="#basic-usage" class="table-of-contents__link toc-highlight">Basic Usage</a><ul><li><a href="#import-the-utilities" class="table-of-contents__link toc-highlight">Import the Utilities</a></li><li><a href="#creating-safe-mats" class="table-of-contents__link toc-highlight">Creating Safe Mats</a></li><li><a href="#validation" class="table-of-contents__link toc-highlight">Validation</a></li><li><a href="#safe-cleanup" class="table-of-contents__link toc-highlight">Safe Cleanup</a></li></ul></li><li><a href="#pattern-generation" class="table-of-contents__link toc-highlight">Pattern Generation</a><ul><li><a href="#checkerboard-pattern" class="table-of-contents__link toc-highlight">Checkerboard Pattern</a></li><li><a href="#gradient-pattern" class="table-of-contents__link toc-highlight">Gradient Pattern</a></li><li><a href="#geometric-shapes" class="table-of-contents__link toc-highlight">Geometric Shapes</a></li><li><a href="#noise-patterns" class="table-of-contents__link toc-highlight">Noise Patterns</a></li></ul></li><li><a href="#motion-detection-testing" class="table-of-contents__link toc-highlight">Motion Detection Testing</a><ul><li><a href="#creating-motion-sequences" class="table-of-contents__link toc-highlight">Creating Motion Sequences</a></li><li><a href="#creating-changed-regions" class="table-of-contents__link toc-highlight">Creating Changed Regions</a></li></ul></li><li><a href="#mat-comparison" class="table-of-contents__link toc-highlight">Mat Comparison</a></li><li><a href="#debugging" class="table-of-contents__link toc-highlight">Debugging</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#1-always-use-try-finally-for-cleanup" class="table-of-contents__link toc-highlight">1. Always Use Try-Finally for Cleanup</a></li><li><a href="#2-validate-before-operations" class="table-of-contents__link toc-highlight">2. Validate Before Operations</a></li><li><a href="#3-use-descriptive-context-in-validation" class="table-of-contents__link toc-highlight">3. Use Descriptive Context in Validation</a></li><li><a href="#4-create-matvectors-safely" class="table-of-contents__link toc-highlight">4. Create MatVectors Safely</a></li></ul></li><li><a href="#example-test" class="table-of-contents__link toc-highlight">Example Test</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#jvm-crashes-exit-code-134" class="table-of-contents__link toc-highlight">JVM Crashes (Exit Code 134)</a></li><li><a href="#common-issues-and-solutions" class="table-of-contents__link toc-highlight">Common Issues and Solutions</a></li></ul></li><li><a href="#integration-with-pixelchangedetector" class="table-of-contents__link toc-highlight">Integration with PixelChangeDetector</a></li><li><a href="#see-also" class="table-of-contents__link toc-highlight">See Also</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/watch?v=aHnVQ8KmOVw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Introductory Video</a></li><li class="footer__item"><a class="footer__link-item" href="/brobot/docs/getting-started/introduction">Get Started</a></li><li class="footer__item"><a class="footer__link-item" href="/brobot/visualAPI">The Visual API</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/brobot" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/brobot/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/jspinak/brobot" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgRljq-lHkMLrzRzpJC4HNw" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://search.maven.org/artifact/io.github.jspinak/brobot" target="_blank" rel="noopener noreferrer" class="footer__link-item">Maven Central<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 Joshua Spinak · Free & Open Source</div></div></div></footer></div>
</body>
</html>